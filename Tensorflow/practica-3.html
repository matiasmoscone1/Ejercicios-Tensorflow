<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"></script>
    <title>Document</title>
</head>
<body>
    
    <script>
    /* 
    
    /*Regresión lineal simple

    Objetivo:
    Entrenar un modelo que aprenda la función lineal:

        y = 2x+1

    Indicaciones:

        Crea un modelo secuencial.

        Agrega una sola capa densa con units: 1 y inputShape: [1].

    Compila el modelo con:

        optimizer: 'sgd'
        loss: 'meanSquaredError'

    Entrena el modelo con valores:

        const xs = tf.tensor2d([1, 2, 3, 4], [4, 1]);
        const ys = tf.tensor2d([3, 5, 7, 9], [4, 1]);
    
        Una vez entrenado, haz una predicción para x = 5.
    El resultado debería acercarse a 11.

*/

        /* EJERCICIO BONUS */

        const predictFunction = async () => {
            const model = tf.sequential();

            //capa 1
            model.add(tf.layers.dense({units: 1, inputShape: [1]}));

            model.compile({
                optimizer: "sgd",
                loss: "meanSquaredError"
            });

            const xs = tf.tensor2d([1, 2, 3, 4], [4, 1]);
            const ys = tf.tensor2d([3, 5, 7, 9], [4, 1]);


            await model.fit(xs, ys, {
                batchSize: 4,
                epochs: 300,
                callbacks: {
                    onEpochEnd: (epoch, logs) => {
                        console.log(`Epoca: ${epoch + 1}: - Perdida: ${logs.loss}`);
                    }
                }
            });

            tf.tidy(() => {
                const output = model.predict(tf.tensor2d([5], [1, 1]));

                //output.print();

                output.array().then((num) => {
                    console.log(num[0][0]);
                });
            })

            //para saber cuantos parametros hay en cada capa
            //model.summary();

        }

        //predictFunction();


        //para saber que backend esta usando tensorflow: (cpu o webgl o wasm)
        //console.log(tf.getBackend());
        

        /* EJERCICIO 2 (MODELOS) */
    
        //Regresión múltiple:
            //Predecir el precio de una casa usando metros² y cantidad de habitaciones.

            //entrada = metros cuadrados (50, 100, 80)
            //entrada = habitaciones (1, 2, 3, 4)
            //salida = precio
        
            //y = metros² * 10  +  habitaciones * 50  +  20
   
        const ejercicio_2 = async () => {
        
            const model = tf.sequential();

            //layer 1
            
            model.add(tf.layers.dense({units: 1, inputShape: [2]}));

            model.compile({
                optimizer: tf.train.sgd(0.01),
                loss: "meanSquaredError"
            });
            
            /*
            const xs = tf.tensor2d([[30/120, 1/6], [50/120, 2/6], [70/120, 3/6], [90/120, 4/6]], [4, 2]);

            const ys = tf.tensor2d([[370/1200], [620/1200], [870/1200], [1120/1200]], [4, 1]);
            */
            const xs = tf.tensor2d([
                [30/120, 1/6],
                [35/120, 1/6],
                [40/120, 2/6],
                [45/120, 2/6],
                [50/120, 2/6],
                [55/120, 3/6],
                [60/120, 3/6],
                [65/120, 3/6],
                [70/120, 4/6],
                [75/120, 4/6],
                [80/120, 4/6],
                [85/120, 5/6],
                [90/120, 5/6],
                [95/120, 5/6],
                [100/120, 6/6],
                [105/120, 6/6],
                [110/120, 6/6],
                [115/120, 6/6],
                [120/120, 6/6],
                [118/120, 5/6],
            ], [20, 2]);

            const ys = tf.tensor2d([
                [350/2000],
                [380/2000],
                [450/2000],
                [500/2000],
                [600/2000],
                [650/2000],
                [700/2000],
                [750/2000],
                [800/2000],
                [850/2000],
                [900/2000],
                [1000/2000],
                [1100/2000],
                [1200/2000],
                [1300/2000],
                [1400/2000],
                [1500/2000],
                [1600/2000],
                [1700/2000],
                [1550/2000],
            ], [20, 1]);


            await model.fit(xs, ys, {
                batchSize: 20,
                epochs: 200,
                callbacks: {
                    onEpochEnd: (epoch, logs) => {
                        console.log(`Epoca: ${epoch + 1} - Perdida: ${logs.loss}`);
                    }
                }
            });

            
            tf.tidy(() => {
                const output = model.predict(tf.tensor2d([113/120, 6/6], [1, 2]));

                output.array().then((num) => {
                    console.log(num[0][0] * 2000);
                });

            });

        }


        //ejercicio_2();


        /* Clasificación binaria básica:
        Entrenar un modelo para clasificar si un número es mayor o menor que 5. */


        const ejercicio_3 = async () => {
        
            const model = tf.sequential();

            //layer 1
            model.add(tf.layers.dense({units: 1, inputShape:[1]}));

            model.compile({
                optimizer: "sgd",
                loss: "meanSquaredError"
            });

            const xs = tf.tensor2d([1, 2, 3, 4, 5, 6, 7, 8], [8, 1]);
            const ys = tf.tensor2d([0, 0, 0, 0, 0, 1, 1, 1], [8, 1]);

            
            await model.fit(xs, ys, {
                batchSize: 8,
                epochs: 100,
                callbacks: {
                    onEpochEnd: (epoch, log) => {
                        console.log(`Epoca: ${epoch + 1} - Perdida: ${log.loss}`)
                    }
                }
            });

            tf.tidy(() => {
                const output = model.predict(tf.tensor2d([15], [1, 1]));

                output.array().then((num) => {
                    console.log(num[0][0]);
                });
            });

        }

        ejercicio_3();






    </script>


</body>
</html>